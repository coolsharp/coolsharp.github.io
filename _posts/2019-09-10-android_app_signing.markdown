---
layout: post
title:  "Android App Siging"
date:   2019-09-10 16:00:00 +0900
categories: android library
---

## 안드로이드 앱 사이닝 구글 플레이에서 관리
---
### 앱 사이닝이란?

안드로이드 apk는 배포를 하기 위해서 앱마다 개발자만 가지고 있는 고유한 사이닝이 되어있어야 한다. 안드로이드 apk는 쉽게 역어셈블링되어 디컴파일하여 수정 후 재 패키징을 할 수 있다. 디컴파일후 재 패키징할 때는 다시 사이닝 과정이 필요하며 사이닝 키 없이는 사이닝이 불가하다. 이런 원리로 사이닝키는 원 개발자만 가지고 있으므로 변조된 앱을 구분할 수 있다. 하지만 일부 개발자들이 키 관리를 잘못하여 삭제하는 경우가 종종 발생한다. 만약 사이닝키를 분실하면 구글 플레이에 더이상 앱 업데이트를 할 수 없다. 이런 경우를 방지코자 구굴 플레이에서 사이닝 키를 관리해주는 서비스를 제공한다.

<h3 align="center">. . .</h3>

### 기존 앱 관리 개념

![9ac5ff19.png](/static/img/post/2019-09-10-android_app_signing/9ac5ff19.png)

개발자는 앱 키를 구글 플레이에 이관합니다. 대신 개발자는 업로드 키를 새로 발급받아 해당 키로 앱을 구글 플레이 등록합니다. 만약 업로드 키를 분실하면 구글 플레이로 소명 메일을 보내 새로운 업로드 키를 발급받아 배포를 진행 할 수 있습니다.

![76f8b4f7.png](/static/img/post/2019-09-10-android_app_signing/76f8b4f7.png)

<h3 align="center">. . .</h3>

### 기존 앱 사이닝 등록하기

##### 1단계: Google Play 앱 서명 등록

> [Play Console](https://play.google.com/apps/publish/)에 로그인합니다.
> 앱을 선택합니다.
> 왼쪽 메뉴에서 출시 관리 > 앱 서명을 선택합니다.
> 아직 동의하지 않은 경우 서비스 약관을 검토하고 동의를 선택합니다.

##### 2단계: Google에 원래 키 전송 및 업로드 키 만들기

> 원래 앱 서명 키를 찾습니다.
> [Play Console](https://play.google.com/apps/publish/)에 로그인합니다.
> 앱을 선택합니다.
> 왼쪽 메뉴에서 출시 관리 > 앱 서명을 선택합니다.
> 출시 프로세스에 가장 적합한 내보내기 및 업로드 옵션을 선택하고 기존 앱 서명 키를 업로드합니다.

##### 3단계: Android Studio 내보낸 키를 업로드

> Android 스튜디오에서 키를 내보냅니다.
> 빌드 메뉴에서 서명된 번들/APK 만들기를 선택합니다. 번들 옵션을 선택하고 다음을 누릅니다.
> 암호화된 키 내보내기를 선택하고 다음을 누릅니다.
> ![55248a28.png](/static/img/post/2019-09-10-android_app_signing/55248a28.png)
> 생성된 private_key.pepk를 구글 플레이 `앱 서명 비공개 키` 버튼을 클릭 후 파일 선택합니다.
> 지금까지 과정을 무사히 진행하였다면 앱 사이닝 키를 구굴 플레이에 등록하였습니다.

##### 4단계: 업로드 키 만들기 및 키 저장소 업데이트(선택사항 및 권장)

> 보안 강화를 위해 앱 서명 키 대신 새로운 업로드 키로 앱에 서명하는 것이 좋습니다.
> Google Play 앱 서명을 선택할 때 업로드 키를 만들거나 나중에 출시 관리 > 앱 서명에서 업로드 키를 만들 수 있습니다.
> 업로드 키를 만드는 방법은 다음과 같습니다.
>
> 1. Android 개발자 사이트에서 안내를 따릅니다. 안전한 곳에 키를 저장하세요.
> 2. 업로드 키의 인증서를 PEM 형식으로 내보냅니다. 밑줄 표시된 다음 인수를 바꿉니다.
> ```shell
> $ keytool -export -rfc -keystore upload-keystore.jks -alias upload -file upload_certificate.pem
> ```
> 3. 출시 프로세스에서 메시지가 나타나면 인증서를 업로드하여 Google에 등록합니다.
>
> 업로드 키를 사용하는 경우:
> 업로드 키는 Google에만 등록되며 앱 제작자의 신원 인증에 사용됩니다.
> 서명은 사용자에게 전송되기 전에 업로드된 모든 APK에서 삭제됩니다.

##### 5단계: 업로드 키 만들기(선택사항 및 권장)

> 업로드 키를 만들고 인증서를 Google Play에 업로드합니다.
> 앱 서명 키를 업로드 키로 계속 사용할 수도 있습니다.
> 앱 서명 인증서의 지문(MD5, SHA-1 및 SHA-256)을 복사합니다.
> 테스트를 위해 인증서 지문 및 앱 서명 키를 사용하여 업로드 키 인증서를 API 제공업체에 등록해야 할 수 있습니다.

##### 6단계: 업로드 키로 다음 앱 업데이트 서명

> 앱 업데이트를 출시하면 업로드 키를 사용하여 서명해야 합니다.
> - 새로운 업로드 키를 생성하지 않은 경우: 원래 앱 서명 키를 계속 사용하여 버전을 Google Play에 업로드하기 전에 서명합니다. 앱 서명 키를 분실했다면 > 새 업로드 키를 생성하고 Google에 등록하여 계속 앱을 업데이트할 수 있습니다.
> - 새 업로드 키를 생성한 경우: 새 업로드 키를 사용하여 버전을 Google Play에 업로드하기 전에 서명합니다. 버전을 업로드하고 나면 Google이 버전에서 > 업로드 키를 확인하여 신원을 확인합니다. 업로드 키를 분실했다면 지원팀에 문의하여 재설정할 수 있습니다.

<h3 align="center">. . .</h3>

### 신규 앱 등록

##### 1단계: Google Play 앱 서명 등록

> [앱 서명  \|  Android Developers](https://developer.android.com/studio/publish/app-signing)에 따라 업로드 키를 만듭니다.
> 업로드 키로 새 APK에 서명합니다.

##### 2단계: 버전 준비

> 안내에 따라 버전을 준비하고 출시합니다.
> 출시 트랙을 선택한 후 'Google에서 앱 서명 키를 관리 및 보호하도록 허용' 섹션에서 앱 서명을 구성합니다.
> 생성된 키가 향후 버전에 서명하는 데 사용할 업로드 키 또는 다음 사항을 포함하는 고급 옵션이 되도록 계속을 선택합니다.
> - 개발자 계정에서 다른 앱과 같은 키를 사용(옵션 2).
> - 기존 앱 서명 키 업로드(옵션 2, 3, 4): 가장 적합한 내보내기 및 업로드 옵션을 선택하세요. 앱 서명 키 및 공개 인증서를 업로드하면 업로드 키를 만들거나 앱 서명 키를 업로드 키로 계속 사용할 수 있습니다.
> 참고: 계속하려면 서비스 약관에 동의하고 앱 서명을 선택해야 합니다.

##### 3단계: API 제공업체에 앱 서명 키 등록

> 앱에서 API를 사용하는 경우 일반적으로 인증서의 지문을 사용하여 Google이 앱에 서명하는 데 사용하는 키의 인증서를 등록하여 인증해야 합니다. 인증서를 찾을 수 있는 위치는 다음과 같습니다.
> [Play Console](https://play.google.com/apps/publish/)에 로그인합니다.
> 앱을 선택합니다.
> 왼쪽 메뉴에서 출시 관리 > 앱 서명을 선택합니다.
> 앱 서명 인증서의 지문(MD5, SHA-1 및 SHA-256)을 복사합니다.
>  - API 제공업체가 다른 유형의 지문을 요구하면 .der 형식의 원래 인증서를 다운로드하고 API 제공업체가 요구하는 변환 도구를 사용하여 변환할 수 있습니다.
